#########################################################################
# LP bug #830286: rows_read is overflowed when changing db
#########################################################################

SET LOCAL long_query_time=0;

--let $log_file=percona_bug830286_slow
--source include/log_start.inc

--disable_ps_protocol
CREATE TABLE t1(a INT);
INSERT INTO t1 VALUES (1), (2), (3), (4);
SELECT * FROM t1 LIMIT 1;
--enable_ps_protocol

--source include/log_stop.inc

perl;
  $slogfile= $ENV{'log_file_full_path'};

  open(FILE, "$slogfile") or
    die("Unable to read slow query log file $slogfile: $!\n");
  while(<FILE>) {
    next if (!/^# Query_time:/);
    s/.*(Rows_read: [0-9]+)/$1/g;
    print;
  }

  close(FILE);
EOF

DROP TABLE t1;

--source include/log_cleanup.inc
