--source include/have_binlog_format_statement.inc
--source include/master-slave.inc

connection master;
-- disable_warnings
DROP TABLE IF EXISTS t;
-- enable_warnings
CREATE TABLE t(id INT);

connection master;
INSERT INTO t VALUES (1);
sync_slave_with_master;

connection slave;
--source include/percona_slow_extended-show.inc
set global log_slow_slave_statements=ON;
--source include/percona_slow_extended-show.inc

connection master;
INSERT INTO t VALUES (2);
sync_slave_with_master;

connection slave;
STOP SLAVE;
--source include/wait_for_slave_to_stop.inc
START SLAVE;
--source include/wait_for_slave_to_start.inc

connection slave;
--source include/percona_slow_extended-show.inc

connection master;
INSERT INTO t VALUES (3);
sync_slave_with_master;

connection slave;
--source include/percona_slow_extended-show.inc
set global long_query_time=0;
--source include/percona_slow_extended-show.inc

connection master;
INSERT INTO t VALUES (4);
sync_slave_with_master;

connection slave;
--source include/percona_slow_extended-show.inc
set global use_global_long_query_time=1;
--source include/percona_slow_extended-show.inc

connection master;
INSERT INTO t VALUES (5);
sync_slave_with_master;

connection slave;
--source include/percona_slow_extended-show.inc
set global long_query_time=1;
set global use_global_long_query_time=0;
--source include/percona_slow_extended-show.inc

let $i=5;
let $k=1;
let $cmd=cat $MYSQLTEST_VARDIR/mysqld.1/data/percona_log_slow_slave_statements-master.log | grep;
while($i)
{
    let $current_cmd =echo "Master	'INSERT INTO t VALUES($k)'	`$cmd "INSERT INTO t VALUES ($k)" | wc -l`";
    exec $current_cmd;
    dec $i;
    inc $k;
}

let $i=5;
let $k=1;
let $cmd=cat $MYSQLTEST_VARDIR/mysqld.2/data/percona_log_slow_slave_statements-slave.log | grep;
while($i)
{
    let $current_cmd =echo "Slave	'INSERT INTO t VALUES($k)'	`$cmd "INSERT INTO t VALUES ($k)" | wc -l`";
    exec $current_cmd;
    dec $i;
    inc $k;
}

connection slave;
set global log_slow_slave_statements=OFF;

connection master;
DROP TABLE t;

sync_slave_with_master;
